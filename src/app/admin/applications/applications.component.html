<div class="dashboard-container">
  <app-admin-sidebar [currentPage]="'applications'"></app-admin-sidebar>

  <!-- Main Content -->
  <main class="dashboard-main">
<div class="applications-container">
  <!-- Header -->
  <div class="page-header">
    <div>
      <h1 class="page-title">Job Applications</h1>
      <p class="page-subtitle">Manage and review all job applications</p>
    </div>
    <div class="header-actions">
      <button class="btn-export">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        Export
      </button>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card" (click)="selectedStatus = 'all'; currentPage = 1">
      <div class="stat-content">
        <p class="stat-label">Total Applications</p>
        <h3 class="stat-value">{{ statusCounts.all }}</h3>
      </div>
      <div class="stat-icon all">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
      </div>
    </div>

    <div class="stat-card" (click)="selectedStatus = 'New'; currentPage = 1">
      <div class="stat-content">
        <p class="stat-label">New</p>
        <h3 class="stat-value">{{ statusCounts.New }}</h3>
      </div>
      <div class="stat-icon new">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <path d="M12 6v6l4 2"></path>
        </svg>
      </div>
    </div>

    <div class="stat-card" (click)="selectedStatus = 'Interview'; currentPage = 1">
      <div class="stat-content">
        <p class="stat-label">Interview</p>
        <h3 class="stat-value">{{ statusCounts.Interview }}</h3>
      </div>
      <div class="stat-icon interview">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
          <polyline points="22 4 12 14.01 9 11.01"></polyline>
        </svg>
      </div>
    </div>

    <div class="stat-card" (click)="selectedStatus = 'Hired'; currentPage = 1">
      <div class="stat-content">
        <p class="stat-label">Hired</p>
        <h3 class="stat-value">{{ statusCounts.Hired }}</h3>
      </div>
      <div class="stat-icon hired">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="search-box">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
      <input 
        type="text" 
        placeholder="Search by name, email, or position..." 
        [(ngModel)]="searchTerm"
        (ngModelChange)="currentPage = 1"
        class="search-input">
    </div>

    <select [(ngModel)]="selectedStatus" (ngModelChange)="currentPage = 1" class="filter-select">
      <option value="all">All Status</option>
      <option value="New">New</option>
      <option value="Reviewed">Reviewed</option>
      <option value="Interview">Interview</option>
      <option value="Hired">Hired</option>
      <option value="Rejected">Rejected</option>
    </select>

    <select [(ngModel)]="selectedCategory" (ngModelChange)="currentPage = 1" class="filter-select">
      <option value="all">All Categories</option>
      <option value="carers">Carers</option>
      <option value="partners">Partners</option>
      <option value="support">Support Staff</option>
    </select>

    <button class="btn-clear" (click)="clearFilters()" *ngIf="searchTerm || selectedStatus !== 'all' || selectedCategory !== 'all'">
      Clear Filters
    </button>
  </div>

  <!-- Applications Table -->
  <div class="table-container">
    <table class="applications-table">
      <thead>
        <tr>
          <th>Applicant</th>
          <th>Position</th>
          <th>Contact</th>
          <th>Applied</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let app of paginatedApplications" class="table-row">
          <td>
            <div class="applicant-info">
              <div class="applicant-avatar">{{ app.name.charAt(0) }}</div>
              <div>
                <p class="applicant-name">{{ app.name }}</p>
                <p class="applicant-experience">{{ app.experience }} experience</p>
              </div>
            </div>
          </td>
          <td>
            <p class="position-title">{{ app.position }}</p>
            <span class="category-badge">{{ app.category }}</span>
          </td>
          <td>
            <p class="contact-email">{{ app.email }}</p>
            <p class="contact-phone">{{ app.phone }}</p>
          </td>
          <td>
            <span class="date-text">{{ formatDate(app.appliedDate) }}</span>
          </td>
          <td>
            <select 
              [(ngModel)]="app.status" 
              (ngModelChange)="updateStatus(app.id, $event)"
              class="status-select"
              [class]="'status-' + app.status.toLowerCase()">
              <option value="New">New</option>
              <option value="Reviewed">Reviewed</option>
              <option value="Interview">Interview</option>
              <option value="Hired">Hired</option>
              <option value="Rejected">Rejected</option>
            </select>
          </td>
          <td>
            <div class="action-buttons">
              <button class="btn-action view" (click)="viewDetails(app)" title="View Details">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
              </button>
              <button class="btn-action download" (click)="downloadCV(app)" title="Download CV">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                  <polyline points="7 10 12 15 17 10"></polyline>
                  <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
              </button>
              <button class="btn-action delete" (click)="deleteApplication(app.id)" title="Delete">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="filteredApplications.length === 0">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
      <h3>No applications found</h3>
      <p>Try adjusting your filters or search terms</p>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination" *ngIf="totalPages > 1">
    <button class="pagination-btn" (click)="previousPage()" [disabled]="currentPage === 1">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
    </button>

    <div class="pagination-numbers">
      <button 
        *ngFor="let page of [].constructor(totalPages); let i = index"
        class="pagination-number"
        [class.active]="currentPage === i + 1"
        (click)="goToPage(i + 1)">
        {{ i + 1 }}
      </button>
    </div>

    <button class="pagination-btn" (click)="nextPage()" [disabled]="currentPage === totalPages">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    </button>
      </div>
    </div>
  </main>
</div>

<!-- Details Modal -->
<div class="modal-overlay" *ngIf="showDetailsModal" (click)="closeDetailsModal()">
  <div class="modal-content" (click)="$event.stopPropagation()" *ngIf="selectedApplication">
    <div class="modal-header">
      <h2>Application Details</h2>
      <button class="modal-close" (click)="closeDetailsModal()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <div class="detail-section">
        <h3>Personal Information</h3>
        <div class="detail-grid">
          <div class="detail-item">
            <span class="detail-label">Full Name</span>
            <span class="detail-value">{{ selectedApplication.name }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Email</span>
            <span class="detail-value">{{ selectedApplication.email }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Phone</span>
            <span class="detail-value">{{ selectedApplication.phone }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Experience</span>
            <span class="detail-value">{{ selectedApplication.experience }}</span>
          </div>
        </div>
      </div>

      <div class="detail-section">
        <h3>Application Details</h3>
        <div class="detail-grid">
          <div class="detail-item">
            <span class="detail-label">Position</span>
            <span class="detail-value">{{ selectedApplication.position }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Category</span>
            <span class="detail-value">{{ selectedApplication.category }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Applied Date</span>
            <span class="detail-value">{{ formatDate(selectedApplication.appliedDate) }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Availability</span>
            <span class="detail-value">{{ selectedApplication.availability }}</span>
          </div>
        </div>
      </div>

      <div class="detail-section">
        <h3>Status</h3>
        <select 
          [(ngModel)]="selectedApplication.status" 
          (ngModelChange)="updateStatus(selectedApplication.id, $event)"
          class="status-select-large"
          [class]="'status-' + selectedApplication.status.toLowerCase()">
          <option value="New">New</option>
          <option value="Reviewed">Reviewed</option>
          <option value="Interview">Interview</option>
          <option value="Hired">Hired</option>
          <option value="Rejected">Rejected</option>
        </select>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="downloadCV(selectedApplication)">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        Download CV
      </button>
      <button class="btn-primary" (click)="closeDetailsModal()">Close</button>
    </div>
  </div>
</div>