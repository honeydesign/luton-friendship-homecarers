<div class="admin-layout">
  <app-admin-sidebar 
    [activeRoute]="'jobs'"
    (navigate)="navigateTo($event)"
    (logoutEvent)="logout()">
  </app-admin-sidebar>

  <div class="main-content">
    <div class="content-header">
      <h1>Manage Jobs</h1>
      <button class="btn-primary" (click)="openAddJobModal()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        Create New Job
      </button>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <h3>Total Jobs</h3>
        <p class="stat-number">{{ jobStats.total }}</p>
      </div>
      <div class="stat-card">
        <h3>Active</h3>
        <p class="stat-number">{{ jobStats.active }}</p>
      </div>
      <div class="stat-card">
        <h3>Inactive</h3>
        <p class="stat-number">{{ jobStats.inactive }}</p>
      </div>
      <div class="stat-card">
        <h3>Total Applicants</h3>
        <p class="stat-number">{{ jobStats.totalApplicants }}</p>
      </div>
    </div>

    <!-- Filters -->
    <div class="filters">
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        placeholder="Search jobs..."
        class="search-input">
      <select [(ngModel)]="filterCategory" class="filter-select">
        <option value="all">All Categories</option>
        <option value="carers">Carers</option>
        <option value="partners">Partners</option>
        <option value="support">Support Staff</option>
      </select>
      <select [(ngModel)]="filterStatus" class="filter-select">
        <option value="all">All Status</option>
        <option value="active">Active</option>
        <option value="inactive">Inactive</option>
      </select>
    </div>

    <!-- Jobs List -->
    <div class="jobs-list" *ngIf="!isLoading; else loading">
      <div class="job-item" *ngFor="let job of filteredJobs">
        <div class="job-info">
          <h3>{{ job.title }}</h3>
          <p>{{ job.category }} • {{ job.type }} • {{ job.location }}</p>
          <span class="applicant-count">{{ job.applicants }} applicants</span>
        </div>
        <div class="job-actions">
          <label class="toggle-switch">
            <input 
              type="checkbox" 
              [checked]="job.isActive" 
              (change)="toggleJobStatus(job)">
            <span class="toggle-slider"></span>
          </label>
          <button class="btn-edit" (click)="openEditJobModal(job)">Edit</button>
          <button class="btn-delete" (click)="deleteJob(job.id)">Delete</button>
        </div>
      </div>
    </div>

    <ng-template #loading>
      <div class="loading">Loading jobs...</div>
    </ng-template>
  </div>
</div>

<!-- SIMPLIFIED Job Modal -->
<div class="modal-overlay" *ngIf="showJobModal" (click)="closeJobModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ isEditMode ? 'Edit Job' : 'Create New Job' }}</h2>
      <button class="modal-close" (click)="closeJobModal()">×</button>
    </div>

    <div class="modal-body">
      <form #jobForm="ngForm">
        <!-- Basic Info -->
        <div class="form-row">
          <div class="form-group">
            <label>Job Title *</label>
            <input type="text" [(ngModel)]="currentJob.title" name="title" required>
          </div>
          <div class="form-group">
            <label>Category *</label>
            <select [(ngModel)]="currentJob.category" name="category">
              <option value="carers">Carers</option>
              <option value="partners">Partners</option>
              <option value="support">Support Staff</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Job Type</label>
            <select [(ngModel)]="currentJob.type" name="type">
              <option value="Full-time">Full-time</option>
              <option value="Part-time">Part-time</option>
              <option value="Contract">Contract</option>
            </select>
          </div>
          <div class="form-group">
            <label>Location</label>
            <input type="text" [(ngModel)]="currentJob.location" name="location">
          </div>
        </div>

        <div class="form-group">
          <label>Salary</label>
          <input type="text" [(ngModel)]="currentJob.salary" name="salary" placeholder="e.g., £25,000 - £30,000">
        </div>

        <div class="form-group">
          <label>Summary</label>
          <textarea [(ngModel)]="currentJob.summary" name="summary" rows="2"></textarea>
        </div>

        <div class="form-group">
          <label>Description *</label>
          <textarea [(ngModel)]="currentJob.description" name="description" rows="4" required></textarea>
        </div>

        <!-- Requirements - TEXTAREA INSTEAD OF LIST -->
        <div class="form-group">
          <label>Requirements (one per line)</label>
          <textarea 
            [(ngModel)]="requirementsText" 
            name="requirementsText" 
            rows="4" 
            placeholder="NVQ Level 2&#10;Right to work in UK&#10;Clean DBS check"></textarea>
          <small>Enter each requirement on a new line</small>
        </div>

        <!-- Qualifications - TEXTAREA -->
        <div class="form-group">
          <label>Qualifications (one per line)</label>
          <textarea 
            [(ngModel)]="qualificationsText" 
            name="qualificationsText" 
            rows="4" 
            placeholder="Assist with daily living&#10;Medication administration"></textarea>
        </div>

        <!-- Skills - TEXTAREA -->
        <div class="form-group">
          <label>Skills (one per line)</label>
          <textarea 
            [(ngModel)]="skillsText" 
            name="skillsText" 
            rows="4" 
            placeholder="Compassionate care&#10;Good communication&#10;Time management"></textarea>
        </div>

        <!-- Certifications - TEXTAREA -->
        <div class="form-group">
          <label>Certifications (one per line)</label>
          <textarea 
            [(ngModel)]="certificationsText" 
            name="certificationsText" 
            rows="3" 
            placeholder="First Aid Certificate&#10;Food Hygiene Certificate"></textarea>
        </div>

        <!-- Benefits - TEXTAREA -->
        <div class="form-group">
          <label>Benefits (one per line)</label>
          <textarea 
            [(ngModel)]="benefitsText" 
            name="benefitsText" 
            rows="4" 
            placeholder="Competitive salary&#10;Paid training&#10;Pension scheme&#10;Flexible hours"></textarea>
        </div>

        <div class="form-group">
          <label>Working Hours</label>
          <input type="text" [(ngModel)]="currentJob.workingHours" name="workingHours" placeholder="e.g., Full-time, flexible shifts">
        </div>

        <div class="form-group">
          <label>Experience Required</label>
          <input type="text" [(ngModel)]="currentJob.experience" name="experience" placeholder="e.g., 2+ years">
        </div>

        <div class="form-group">
          <label>Training Provided</label>
          <textarea [(ngModel)]="currentJob.training" name="training" rows="3"></textarea>
        </div>

        <div class="form-group">
          <label>Start Date</label>
          <input type="text" [(ngModel)]="currentJob.startDate" name="startDate" placeholder="e.g., Immediate">
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="currentJob.isActive" name="isActive">
            Active (visible to applicants)
          </label>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn-secondary" (click)="closeJobModal()">Cancel</button>
          <button type="button" class="btn-primary" (click)="saveJobSimple()">
            {{ isEditMode ? 'Update Job' : 'Create Job' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
