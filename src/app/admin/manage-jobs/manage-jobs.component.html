<div class="dashboard-container">
  <app-admin-sidebar [currentPage]="'jobs'"></app-admin-sidebar>

  <!-- Main Content -->
  <main class="dashboard-main">
    <div class="jobs-container">
      <!-- Header -->
      <div class="page-header">
        <div>
          <h1 class="page-title">Manage Jobs</h1>
          <p class="page-subtitle">Create, edit, and manage your job postings</p>
        </div>
        <button class="btn-add-job" (click)="openAddJobModal()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Add New Job
        </button>
      </div>

      <!-- Stats Cards -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-content">
            <p class="stat-label">Total Jobs</p>
            <h3 class="stat-value">{{ jobStats.total }}</h3>
          </div>
          <div class="stat-icon total">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
              <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
            </svg>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-content">
            <p class="stat-label">Active</p>
            <h3 class="stat-value">{{ jobStats.active }}</h3>
          </div>
          <div class="stat-icon active">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-content">
            <p class="stat-label">Inactive</p>
            <h3 class="stat-value">{{ jobStats.inactive }}</h3>
          </div>
          <div class="stat-icon inactive">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="15" y1="9" x2="9" y2="15"></line>
              <line x1="9" y1="9" x2="15" y2="15"></line>
            </svg>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-content">
            <p class="stat-label">Total Applicants</p>
            <h3 class="stat-value">{{ jobStats.totalApplicants }}</h3>
          </div>
          <div class="stat-icon applicants">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
          </div>
        </div>
      </div>

      <!-- Filters -->
      <div class="filters-section">
        <div class="search-box">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <input 
            type="text" 
            placeholder="Search jobs..." 
            [(ngModel)]="searchTerm"
            class="search-input">
        </div>

        <select [(ngModel)]="filterCategory" class="filter-select">
          <option value="all">All Categories</option>
          <option value="carers">Carers</option>
          <option value="partners">Partners</option>
          <option value="support">Support Staff</option>
        </select>

        <select [(ngModel)]="filterStatus" class="filter-select">
          <option value="all">All Status</option>
          <option value="active">Active</option>
          <option value="inactive">Inactive</option>
        </select>
      </div>

      <!-- Jobs Grid -->
      <div class="jobs-grid">
        <div class="job-card" *ngFor="let job of filteredJobs">
          <div class="job-card-header">
            <div>
              <h3 class="job-title">{{ job.title }}</h3>
              <div class="job-meta">
                <span class="meta-item">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                    <circle cx="12" cy="10" r="3"></circle>
                  </svg>
                  {{ job.location }}
                </span>
                <span class="meta-item">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="1" x2="12" y2="23"></line>
                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                  </svg>
                  {{ job.salary }}
                </span>
              </div>
            </div>
            <div class="status-toggle">
              <label class="toggle-switch">
                <input 
                  type="checkbox" 
                  [checked]="job.isActive"
                  (change)="toggleJobStatus(job)">
                <span class="toggle-slider"></span>
              </label>
              <span class="status-label" [class.active]="job.isActive">
                {{ job.isActive ? 'Active' : 'Inactive' }}
              </span>
            </div>
          </div>

          <p class="job-summary">{{ job.summary }}</p>

          <div class="job-tags">
            <span class="tag" *ngFor="let tag of job.tags">{{ tag }}</span>
            <span class="tag category">{{ job.category }}</span>
            <span class="tag type">{{ job.type }}</span>
          </div>

          <div class="job-footer">
            <div class="job-stats">
              <span class="stat">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="4"></circle>
                </svg>
                {{ job.applicants || 0 }} applicants
              </span>
            </div>
            <div class="job-actions">
              <button class="btn-action edit" (click)="openEditJobModal(job)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
                Edit
              </button>
              <button class="btn-action delete" (click)="deleteJob(job.id)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
                Delete
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="filteredJobs.length === 0">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
          <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
        </svg>
        <h3>No jobs found</h3>
        <p>Try adjusting your filters or create a new job posting</p>
        <button class="btn-primary" (click)="openAddJobModal()">Add New Job</button>
      </div>
    </div>
  </main>
</div>

<!-- Add/Edit Job Modal -->
<div class="modal-overlay" *ngIf="showJobModal" (click)="closeJobModal()">
  <div class="modal-content large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ isEditMode ? 'Edit Job' : 'Add New Job' }}</h2>
      <button class="modal-close" (click)="closeJobModal()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <form class="job-form">
        <!-- Basic Information -->
        <div class="form-section">
          <h3 class="section-title">Basic Information</h3>
          <div class="form-grid">
            <div class="form-group">
              <label>Job Title *</label>
              <input type="text" [(ngModel)]="currentJob.title" name="title" placeholder="e.g., Senior Care Assistant" required>
            </div>
            <div class="form-group">
              <label>Category *</label>
              <select [(ngModel)]="currentJob.category" name="category" required>
                <option value="carers">Carers</option>
                <option value="partners">Partners</option>
                <option value="support">Support Staff</option>
              </select>
            </div>
            <div class="form-group">
              <label>Employment Type *</label>
              <select [(ngModel)]="currentJob.type" name="type" required>
                <option value="Full-time">Full-time</option>
                <option value="Part-time">Part-time</option>
                <option value="Contract">Contract</option>
                <option value="Flexible">Flexible</option>
              </select>
            </div>
            <div class="form-group">
              <label>Location *</label>
              <input type="text" [(ngModel)]="currentJob.location" name="location" placeholder="e.g., Luton" required>
            </div>
            <div class="form-group">
              <label>Salary Range *</label>
              <input type="text" [(ngModel)]="currentJob.salary" name="salary" placeholder="e.g., £25,000 - £30,000" required>
            </div>
            <div class="form-group">
              <label>Experience Level *</label>
              <input type="text" [(ngModel)]="currentJob.experience" name="experience" placeholder="e.g., 2+ years" required>
            </div>
          </div>
        </div>

        <!-- Job Description -->
        <div class="form-section">
          <h3 class="section-title">Job Description</h3>
          <div class="form-group">
            <label>Short Summary *</label>
            <input type="text" [(ngModel)]="currentJob.summary" name="summary" placeholder="Brief one-line description" required>
          </div>
          <div class="form-group">
            <label>Full Description *</label>
            <textarea [(ngModel)]="currentJob.description" name="description" rows="5" placeholder="Detailed job description..." required></textarea>
          </div>
        </div>

        <!-- Requirements -->
        <div class="form-section">
          <h3 class="section-title">Requirements</h3>
          <div class="list-input-group">
            <label>Job Requirements</label>
            <div class="list-items">
              <div class="list-item" *ngFor="let req of currentJob.requirements; let i = index">
                <span>{{ req }}</span>
                <button type="button" (click)="removeArrayItem(currentJob.requirements, i)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
              </div>
            </div>
            <div class="add-item-input">
              <input type="text" [(ngModel)]="newRequirement" name="newRequirement" placeholder="Add requirement...">
              <button type="button" (click)="addArrayItem(currentJob.requirements, newRequirement); newRequirement = ''">Add</button>
            </div>
          </div>

          <div class="list-input-group">
            <label>Qualifications</label>
            <div class="list-items">
              <div class="list-item" *ngFor="let qual of currentJob.qualifications; let i = index">
                <span>{{ qual }}</span>
                <button type="button" (click)="removeArrayItem(currentJob.qualifications, i)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
              </div>
            </div>
            <div class="add-item-input">
              <input type="text" [(ngModel)]="newQualification" name="newQualification" placeholder="Add qualification...">
              <button type="button" (click)="addArrayItem(currentJob.qualifications, newQualification); newQualification = ''">Add</button>
            </div>
          </div>

          <div class="list-input-group">
            <label>Skills Needed</label>
            <div class="list-items">
              <div class="list-item" *ngFor="let skill of currentJob.skills; let i = index">
                <span>{{ skill }}</span>
                <button type="button" (click)="removeArrayItem(currentJob.skills, i)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
              </div>
            </div>
            <div class="add-item-input">
              <input type="text" [(ngModel)]="newSkill" name="newSkill" placeholder="Add skill...">
              <button type="button" (click)="addArrayItem(currentJob.skills, newSkill); newSkill = ''">Add</button>
            </div>
          </div>

          <div class="list-input-group">
            <label>Certifications Required</label>
            <div class="list-items">
              <div class="list-item" *ngFor="let cert of currentJob.certifications; let i = index">
                <span>{{ cert }}</span>
                <button type="button" (click)="removeArrayItem(currentJob.certifications, i)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
              </div>
            </div>
            <div class="add-item-input">
              <input type="text" [(ngModel)]="newCertification" name="newCertification" placeholder="Add certification...">
              <button type="button" (click)="addArrayItem(currentJob.certifications, newCertification); newCertification = ''">Add</button>
            </div>
          </div>

          <div class="form-group">
            <label>Working Hours</label>
            <input type="text" [(ngModel)]="currentJob.workingHours" name="workingHours" placeholder="e.g., Full-time, flexible shifts">
          </div>
        </div>

        <!-- Benefits -->
        <div class="form-section">
          <h3 class="section-title">Benefits & Training</h3>
          <div class="list-input-group">
            <label>Benefits</label>
            <div class="list-items">
              <div class="list-item" *ngFor="let benefit of currentJob.benefits; let i = index">
                <span>{{ benefit }}</span>
                <button type="button" (click)="removeArrayItem(currentJob.benefits, i)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
              </div>
            </div>
            <div class="add-item-input">
              <input type="text" [(ngModel)]="newBenefit" name="newBenefit" placeholder="Add benefit...">
              <button type="button" (click)="addArrayItem(currentJob.benefits, newBenefit); newBenefit = ''">Add</button>
            </div>
          </div>

          <div class="form-group">
            <label>Training Provided</label>
            <textarea [(ngModel)]="currentJob.training" name="training" rows="3" placeholder="Describe training and development opportunities..."></textarea>
          </div>
        </div>

        <!-- Additional Info -->
        <div class="form-section">
          <h3 class="section-title">Additional Information</h3>
          <div class="form-grid">
            <div class="form-group">
              <label>Start Date</label>
              <input type="text" [(ngModel)]="currentJob.startDate" name="startDate" placeholder="e.g., Immediate, 2 weeks">
            </div>
            <div class="form-group">
              <label>Application Deadline (Optional)</label>
            </div>
          </div>

          <div class="list-input-group">
            <label>Tags</label>
            <div class="list-items">
              <div class="list-item tag" *ngFor="let tag of currentJob.tags; let i = index">
                <span>{{ tag }}</span>
                <button type="button" (click)="removeArrayItem(currentJob.tags, i)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
              </div>
            </div>
            <div class="add-item-input">
              <input type="text" [(ngModel)]="newTag" name="newTag" placeholder="Add tag...">
              <button type="button" (click)="addArrayItem(currentJob.tags, newTag); newTag = ''">Add</button>
            </div>
          </div>

          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="currentJob.isActive" name="isActive">
              <span>Active (visible on job listings)</span>
            </label>
          </div>
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeJobModal()">Cancel</button>
      <button class="btn-primary" (click)="saveJob()">
        {{ isEditMode ? 'Update Job' : 'Create Job' }}
      </button>
    </div>
  </div>
</div>