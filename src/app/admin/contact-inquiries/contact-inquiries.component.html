<div class="dashboard-container">
  <app-admin-sidebar [currentPage]="'inquiries'"></app-admin-sidebar>

  <!-- Main Content -->
  <main class="dashboard-main">
    <!-- Header -->
    <header class="dashboard-header">
      <div>
        <h1 class="header-title">Contact Inquiries</h1>
        <p class="header-subtitle">Manage customer inquiries and support requests</p>
      </div>
      <div class="header-user">
        <div class="user-avatar">
          <img *ngIf="profileImage" [src]="profileImage" alt="Profile" style="width:100%;height:100%;object-fit:cover;border-radius:inherit;">
          <span *ngIf="!profileImage">A</span>
        </div>
        <div class="user-info">
          <p class="user-name">{{ adminEmail }}</p>
          <p class="user-role">{{ adminRole }}</p>
        </div>
      </div>
    </header>

    <!-- Content Area -->
    <div class="dashboard-content">
      <!-- Status Filter Tabs -->
      <div class="filter-tabs">
        <button 
          class="filter-tab" 
          [class.active]="statusFilter === 'all'"
          (click)="setStatusFilter('all')">
          All <span class="tab-count">{{ statusCounts.all }}</span>
        </button>
        <button 
          class="filter-tab" 
          [class.active]="statusFilter === 'new'"
          (click)="setStatusFilter('new')">
          New <span class="tab-count">{{ statusCounts.new }}</span>
        </button>
        <button 
          class="filter-tab" 
          [class.active]="statusFilter === 'read'"
          (click)="setStatusFilter('read')">
          Read <span class="tab-count">{{ statusCounts.read }}</span>
        </button>
        <button 
          class="filter-tab" 
          [class.active]="statusFilter === 'replied'"
          (click)="setStatusFilter('replied')">
          Replied <span class="tab-count">{{ statusCounts.replied }}</span>
        </button>
      </div>

      <!-- Category Filter Tabs -->
      <div class="category-filter-tabs">
        <button class="category-tab" [class.active]="categoryFilter === 'all'" (click)="setCategoryFilter('all')">All Categories</button>
        <button class="category-tab" [class.active]="categoryFilter === 'FAQ'" (click)="setCategoryFilter('FAQ')">FAQ Questions</button>
        <button class="category-tab" [class.active]="categoryFilter === 'General Inquiry'" (click)="setCategoryFilter('General Inquiry')">General Inquiry</button>
        <button class="category-tab" [class.active]="categoryFilter === 'Job Application'" (click)="setCategoryFilter('Job Application')">Job Application</button>
        <button class="category-tab" [class.active]="categoryFilter === 'Service Information'" (click)="setCategoryFilter('Service Information')">Service Info</button>
        <button class="category-tab" [class.active]="categoryFilter === 'Billing & Payments'" (click)="setCategoryFilter('Billing & Payments')">Billing</button>
      </div>

      <!-- Inquiries List -->
      <div class="inquiries-container">
        <div *ngIf="isLoading" class="loading">Loading inquiries...</div>
        
        <div *ngIf="!isLoading && filteredInquiries.length === 0" class="empty-state">
          <p>No inquiries found</p>
        </div>

        <div *ngIf="!isLoading && filteredInquiries.length > 0" class="inquiries-list">
          <div class="inquiry-card" *ngFor="let inquiry of filteredInquiries">
            <div class="inquiry-header">
              <div class="inquiry-info">
                <h3>{{ inquiry.name }}</h3>
                <span class="inquiry-status" [ngClass]="getStatusClass(inquiry.status)">
                  {{ inquiry.status }}
                </span>
              </div>
              <div class="inquiry-date">
                {{ formatDate(inquiry.created_at) }}
              </div>
            </div>
            
            <div class="inquiry-meta">
              <div class="meta-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                  <polyline points="22,6 12,13 2,6"></polyline>
                </svg>
                <span>{{ inquiry.email }}</span>
              </div>
              <div class="meta-item" *ngIf="inquiry.phone">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                </svg>
                <span>{{ inquiry.phone }}</span>
              </div>
            </div>

            <div class="inquiry-subject" *ngIf="inquiry.subject">
              <strong>Subject:</strong> {{ inquiry.subject }}
            </div>

            <div class="inquiry-message">
              {{ inquiry.message }}
            </div>
            <div class="inquiry-category" *ngIf="inquiry.category">
              <span class="category-badge">{{ inquiry.category }}</span>
            </div>

            <div class="inquiry-reply" *ngIf="inquiry.admin_reply">
              <div class="reply-header">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="9 11 12 14 22 4"></polyline>
                  <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                </svg>
                <strong>Your Reply:</strong>
                <span class="reply-date">{{ formatDate(inquiry.replied_at) }}</span>
              </div>
              <p>{{ inquiry.admin_reply }}</p>
            </div>

            <div class="inquiry-actions">
              <button class="btn-action btn-reply" (click)="openReplyModal(inquiry)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="9 17 4 12 9 7"></polyline>
                  <path d="M20 18v-2a4 4 0 0 0-4-4H4"></path>
                </svg>
                {{ inquiry.admin_reply ? 'Edit Reply' : 'Reply' }}
              </button>
              <button class="btn-action btn-delete" (click)="deleteInquiry(inquiry.id)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
                Delete
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Reply Modal -->
<div class="modal-overlay" *ngIf="showReplyModal" (click)="closeReplyModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Reply to Inquiry</h2>
      <button class="btn-close" (click)="closeReplyModal()">Ã—</button>
    </div>
    <div class="modal-body">
      <div class="inquiry-summary">
        <p><strong>From:</strong> {{ selectedInquiry?.name }} ({{ selectedInquiry?.email }})</p>
        <p><strong>Subject:</strong> {{ selectedInquiry?.subject || 'No subject' }}</p>
        <p><strong>Message:</strong></p>
        <p class="original-message">{{ selectedInquiry?.message }}</p>
      </div>
      <div class="form-group">
        <label for="reply">Your Reply:</label>
        <textarea 
          id="reply" 
          [(ngModel)]="replyText" 
          rows="6" 
          placeholder="Type your reply here..."
          class="form-control"></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeReplyModal()">Cancel</button>
      <button class="btn btn-primary" (click)="sendReply()">Send Reply</button>
    </div>
  </div>
</div>
